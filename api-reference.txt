package securesbom // import "github.com/shiftleftcyber/securesbom-sdk-golang/pkg/securesbom"


CONSTANTS

const (
	DefaultTimeout = 30 * time.Second
	UserAgent      = "secure-sbom-sdk-go/1.0"
)
const (
	API_VERSION              = "/api/v1"
	API_ENDPOINT_HEALTHCHECK = "/infra/healthcheck"
	API_ENDPOINT_KEYS        = "/keys"
	API_ENDPOINT_SBOM        = "/sbom"

	DEFAULT_SECURE_SBOM_BASE_URL = "https://secure-sbom-api-prod-gateway-dhncnyq8.uc.gateway.dev"

	HTTP_METHOD_GET  = http.MethodGet
	HTTP_METHOD_POST = http.MethodPost
)
const (
	Version = "1.0.0"
)
    Version information


FUNCTIONS

func GetVersion() string
    GetVersion returns the SDK version

func WithRetry(ctx context.Context, config RetryConfig, fn func() error) error

TYPES

type APIError struct {
	StatusCode int    `json:"status_code"`
	Message    string `json:"message"`
	Details    string `json:"details,omitempty"`
	RequestID  string `json:"request_id,omitempty"`
}
    APIError represents an error response from the API

func (e *APIError) Error() string

func (e *APIError) Temporary() bool
    Temporary returns true if the error is likely temporary and retryable

type APIErrorResponse struct {
	Error   string `json:"error,omitempty"`
	Message string `json:"message,omitempty"`
}
    APIErrorResponse represents error responses from the API

type Client struct {
	// Has unexported fields.
}

func NewClient(config *Config) (*Client, error)

func (c *Client) GenerateKey(ctx context.Context) (*GenerateKeyCMDResponse, error)

func (c *Client) GetPublicKey(ctx context.Context, keyID string) (string, error)
    GetPublicKey retrieves the public key for a specific key ID

func (c *Client) HealthCheck(ctx context.Context) error

func (c *Client) ListKeys(ctx context.Context) (*KeyListResponse, error)

func (c *Client) SignSBOM(ctx context.Context, keyID string, sbom interface{}) (*SignResultAPIResponse, error)

func (c *Client) VerifySBOM(ctx context.Context, keyID string, signedSBOM interface{}) (*VerifyResultCMDResponse, error)
    VerifySBOM verifies a signed SBOM using the specified key

type ClientInterface interface {
	HealthCheck(ctx context.Context) error
	ListKeys(ctx context.Context) (*KeyListResponse, error)
	GenerateKey(ctx context.Context) (*GenerateKeyCMDResponse, error)
	GetPublicKey(ctx context.Context, keyID string) (string, error)
	SignSBOM(ctx context.Context, keyID string, sbom interface{}) (*SignResultAPIResponse, error)
	VerifySBOM(ctx context.Context, keyID string, signedSBOM interface{}) (*VerifyResultCMDResponse, error)
}

type ClientOption func(*Config)

type Config struct {
	BaseURL    string
	APIKey     string
	HTTPClient HTTPClient
	Timeout    time.Duration
	UserAgent  string
}
    Config holds configuration for the Secure SBOM API client

type ConfigBuilder struct {
	// Has unexported fields.
}

func NewConfigBuilder() *ConfigBuilder

func (b *ConfigBuilder) Build() *Config

func (b *ConfigBuilder) BuildClient() (*Client, error)

func (b *ConfigBuilder) FromEnv() *ConfigBuilder

func (b *ConfigBuilder) WithAPIKey(apiKey string) *ConfigBuilder

func (b *ConfigBuilder) WithBaseURL(baseURL string) *ConfigBuilder

func (b *ConfigBuilder) WithHTTPClient(client HTTPClient) *ConfigBuilder

func (b *ConfigBuilder) WithTimeout(timeout time.Duration) *ConfigBuilder

func (b *ConfigBuilder) WithUserAgent(userAgent string) *ConfigBuilder

type GenerateKeyAPIReponse struct {
	KeyID     string    `json:"id"`
	CreatedAt time.Time `json:"created_at"`
	Algorithm string    `json:"algorithm"`
	PublicKey string    `json:"public_key"`
}

type GenerateKeyCMDResponse struct {
	ID        string    `json:"id"`
	CreatedAt time.Time `json:"created_at"`
	Algorithm string    `json:"algorithm"`
	PublicKey string    `json:"public_key,omitempty"`
	Backend   string    `json:"backend,omitempty"`
}

type HTTPClient interface {
	Do(req *http.Request) (*http.Response, error)
}

type KeyListResponse struct {
	Keys []GenerateKeyCMDResponse `json:"keys"`
}

type ListKeysAPIResponse struct {
	ID        string    `json:"id"`
	CreatedAt time.Time `json:"created_at"`
	Algorithm string    `json:"algorithm"`
	Backend   string    `json:"backend"`
}

type RetryConfig struct {
	MaxAttempts int
	InitialWait time.Duration
	MaxWait     time.Duration
	Multiplier  float64
}

func DefaultRetryConfig() RetryConfig

type RetryingClient struct {
	// Has unexported fields.
}

func WithRetryingClient(client *Client, retryConfig RetryConfig) *RetryingClient

func (r *RetryingClient) GenerateKey(ctx context.Context) (*GenerateKeyCMDResponse, error)

func (r *RetryingClient) GetPublicKey(ctx context.Context, keyID string) (string, error)

func (r *RetryingClient) HealthCheck(ctx context.Context) error

func (r *RetryingClient) ListKeys(ctx context.Context) (*KeyListResponse, error)

func (r *RetryingClient) SignSBOM(ctx context.Context, keyID string, sbom interface{}) (*SignResultAPIResponse, error)

func (r *RetryingClient) VerifySBOM(ctx context.Context, keyID string, signedSBOM interface{}) (*VerifyResultCMDResponse, error)

type SBOM struct {
	// Has unexported fields.
}

func LoadSBOMFromFile(filePath string) (*SBOM, error)

func LoadSBOMFromReader(reader io.Reader) (*SBOM, error)

func NewSBOM(data interface{}) *SBOM

func (s *SBOM) Data() interface{}

func (s *SBOM) String() string

func (s *SBOM) WriteToFile(filePath string) error

func (s *SBOM) WriteToWriter(writer io.Writer) error

type SignResultAPIResponse map[string]interface{}
    intentenoly do not define a type for a sign result since we need to support
    many different types of sboms/reponses

func (sr SignResultAPIResponse) GetSignatureAlgorithm() string
    GetSignatureAlgorithm returns the signature algorithm

func (sr SignResultAPIResponse) GetSignatureValue() string
    GetSignatureValue returns the signature value as a string for convenience

func (sr SignResultAPIResponse) GetSignedSBOMBytes() ([]byte, error)
    GetSignedSBOMBytes returns the complete signed SBOM as JSON bytes

func (sr SignResultAPIResponse) HasSignature() bool
    HasSignature returns true if the SBOM contains a signature

type VerifyResultAPIResponse struct {
	Message   string `json:"message"`
	KeyID     string `json:"key_id"`
	Algorithm string `json:"algorithm"`
}

type VerifyResultCMDResponse struct {
	Valid     bool      `json:"valid"`
	Message   string    `json:"message,omitempty"`
	KeyID     string    `json:"key_id,omitempty"`
	Algorithm string    `json:"algorithm,omitempty"`
	Timestamp time.Time `json:"timestamp,omitempty"`
}

